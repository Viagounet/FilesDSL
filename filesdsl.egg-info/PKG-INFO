Metadata-Version: 2.4
Name: filesdsl
Version: 0.1.0
Summary: A safe file-exploration DSL for LLM agents
Requires-Python: >=3.12
Description-Content-Type: text/markdown
Requires-Dist: pymupdf>=1.26.4
Requires-Dist: python-docx>=1.2.0
Requires-Dist: python-pptx>=1.0.2
Requires-Dist: faiss-cpu>=1.12.0
Requires-Dist: numpy>=2.1.0
Requires-Dist: pytesseract>=0.3.13
Requires-Dist: Pillow>=11.3.0

# FilesDSL
FilesDSL is a small domain-specific language for safe directory/file exploration by LLM agents.
It intentionally exposes only read/search primitives and simple control flow.

## Documentation
- Full language and runtime reference: `docs/FILESDSL_DOCUMENTATION.md`
- LLM agent system prompt template: `docs/SYSTEM_PROMPT_EXAMPLE.md`

## Why this exists
- Terminal agents can do much more than read files.
- This DSL narrows capabilities to file discovery and content inspection.
- Scripts are easy for an LLM to generate and review.
- PDF extraction is powered by PyMuPDF (`pymupdf`).
- Office parsing is supported for Word (`.docx`) and PowerPoint (`.pptx`).

## Language features
- Variables: integers, booleans, strings, lists.
- Control flow: `for`, `if` / `elif` / `else`.
- Builtins: `print(...)`, `len(...)`, `Directory(path, recursive=true|false)`, `File(path)`.
- File access primitives:
  - `file = File("path/to/file.ext")` for direct file access.
  - `file.read()` for full content.
  - `file.read(pages=[1, 5:8, 15])` for selected pages/chunks.
  - `file.search("regex")` returns matching page/chunk numbers.
  - `file.contains("regex")` boolean.
  - `file.head()`, `file.tail()`.
  - `file.table()` best-effort TOC extraction.
    If found, it returns:
    `=== Table of contents for file {file} ===`
    followed by an indented TOC tree with page numbers when available.
    If none is found, it returns: `No table of contents detected for {file}`.
  - `file.semantic_search(query, top_k=5)` semantic retrieval over prepared embeddings.
    Returns the most similar page numbers in that file.
  - `file.snippets("regex")` returns short excerpts.

`file` methods work across PDF, DOCX, PPTX, and plain-text files.
- Directory primitives:
  - iterate with `for file in Directory("data")`.
  - `dir.tree(max_depth=5, max_entries=500)` for a quick structure overview.
  - `dir.search("regex", scope="name"|"content"|"both")`.

`5:8` inside list literals expands inclusively to `5, 6, 7, 8`.

## Safety model
- No imports and no arbitrary Python execution.
- Only the DSL runtime functions are callable.
- `Directory(...)` is sandboxed to a root path (default: script directory).

## Usage with uv
```bash
uv run python -m filesdsl examples/demo.fdsl
```

Optional custom sandbox root:
```bash
uv run python -m filesdsl examples/demo.fdsl --sandbox-root .
```

Prepare semantic index (recursive, page-level):
```bash
uv run fdsl prepare data
```

## Python API
Execute FDSL directly from a Python string:

```python
from filesdsl import execute_fdsl

code = """
docs = Directory("data")
files = docs.search(".*\\.pdf$", scope="name")
count = len(files)
print(count)
"""

history = execute_fdsl(code, cwd=".", sandbox_root=".")
print(history)  # what the FDSL script printed
```

## Example script
```fdsl
docs = Directory("data")
pdfs = docs.search(".*\\.pdf$", scope="name")
print("pdf count:", len(pdfs))

for file in pdfs:
    if file.contains("transformer", ignore_case=true):
        pages = file.search("transformer", ignore_case=true)
        print(file, pages)
        print(file.read(pages=[1, 2:3]))
```

## Test
```bash
uv run python -m unittest discover -s tests -p "test_*.py"
```
